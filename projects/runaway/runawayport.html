<!DOCTYPE html>
<html>
  <body onload='init()'>
	<canvas width=440 height=440 id='canvas'></canvas>
	<script>
		var canvas,c,gameStatus,score,bestScore,playerX,playerY,numEnemies,upKey,downKey,leftKey,rightKey;
    var xPos = new Array();
	  var yPos = new Array();
	  var xSpd = new Array();
	  var ySpd = new Array();
		function init() {
      console.log('init');
			canvas = document.getElementById('canvas');
			c = canvas.getContext('2d');
      document.body.onkeydown = keyPressed;
      document.body.onkeyup = keyReleased;
      start();
		}
		function start() {
      console.log('start');
			gameStatus = 0;
			score = 0;
			if (localStorage.bestScore) {bestScore = localStorage.bestScore} else {bestScore = 0}
			upKey, downKey, leftKey, rightKey = false;
			numEnemies = 0;
			playerX = 190;
      playerY = 190;
			active = setInterval('run()', 10);
		}
		function run() {
      if (gameStatus == 1) {
			if(upKey) {
				playerY--;
				if(playerY<20){playerY=20}
			}
			else if(downKey) {
				playerY++;
				if (playerY>400){playerY=400}
			}
			if(leftKey) {
				playerX--; if(playerX<20){playerX=20}
			}
			else if(rightKey) {
				playerX++;
				if (playerX>400){playerX=400}
			}
			
      if((score%381==0)&&(numEnemies<50)) {
  			if(Math.round(Math.random()*2)==0) {
					xPos[numEnemies] = -10+Math.round(Math.random()*2)*440;
					yPos[numEnemies] = playerY+5;
					xSpd[numEnemies] = 1;
					ySpd[numEnemies] = 0;
				} else {
					xPos[numEnemies] = playerX+5;
					yPos[numEnemies] = -10+Math.round(Math.random()*2)*440;
					xSpd[numEnemies] = 0;
					ySpd[numEnemies] = 1;
				}
				numEnemies++;
			}
			
			//move enemies
			for(i=0;i<numEnemies;i++) {
				if(xPos[i]<20)
					xSpd[i] = 1;
				else if(xPos[i]>410)
					xSpd[i] = -1;
				if(yPos[i]<20)
					ySpd[i] = 1;
				else if(yPos[i]>410)
					ySpd[i] = -1;
				xPos[i] += xSpd[i];
				yPos[i] += ySpd[i];
				if(-20<(playerX-xPos[i])&&(playerX-xPos[i])<10&&
				-20<(playerY-yPos[i])&&(playerY-yPos[i]<10)) {gameStatus = 0;}
			}
			
			score++;}      paint();
		}
      
  function keyPressed(e) {
		var key = e.keyCode;
		if(gameStatus==0) {
			if(key==32) {
				if(score>bestScore)
					bestScore = score;
				score = 0;
				playerX = 190;
        playerY = 190;
				numEnemies = 0;
				gameStatus = 1;
			}
			return;
		}
		
		switch(key) {
		case 38:	downKey = false; upKey = true; break;
		case 40:	upKey = false; downKey = true; break;
		case 37:	rightKey = false; leftKey = true; break;
		case 39:	leftKey = false; rightKey = true; break;
		}
	}
	function keyReleased(e) {
		var key = e.keyCode;
		switch(key) {
		case 38:	upKey = false; break;
		case 40:	downKey = false; break;
		case 37:	leftKey = false; break;
		case 39:	rightKey = false; break;
		}
	}

	function paint() {
    c.fillStyle = 'yellow';
    c.fillRect(0, 0, 440, 440);
		c.fillStyle = 'white';
		c.fillRect(20,20,400,400);
		if(gameStatus==1){c.fillStyle = 'blue';c.fillRect(playerX, playerY, 20, 20);}
		c.fillStyle = 'red';
		for(f=0;f<numEnemies;f++)
			c.fillRect(xPos[f], yPos[f], 10, 10);
		c.fillStyle = 'black';
		c.fillText('Score: '+score, 5, 15);
		c.fillText('Best Score: '+bestScore, 5, 435);
		if(gameStatus==0) {
			c.fillStyle = 'black';
			c.fillText('PRESS SPACEBAR TO START A NEW GAME!', 100, 350);
		}
	}
	</script></body>
</html>